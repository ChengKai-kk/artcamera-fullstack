# 流程概览

## 用户流程

```mermaid
flowchart LR
  A[首页] --> B[风格选择]
  B --> C[拍摄]
  C --> D[生成中]
  D --> E[保存/二维码]
  E -->|无操作超时| A
  D -->|失败| D
```

## 生成流程（时序）

```mermaid
sequenceDiagram
  participant User as 用户
  participant UI as 前端 SPA
  participant API as 后端 API
  participant Provider as AI Provider

  User->>UI: 选择风格
  User->>UI: 拍照
  UI->>API: POST /generate { imageBase64, styleId }
  API->>Provider: 发起生成请求
  Provider-->>API: taskId 或 result
  API-->>UI: { taskId }

  loop 每隔 POLL_INTERVAL 轮询
    UI->>API: GET /tasks/:id
    API->>Provider: 查询任务（或读缓存）
    Provider-->>API: status + resultUrl
    API-->>UI: { status, resultUrl }
  end

  UI-->>User: 展示结果并生成二维码
```

## 异常与恢复

- 摄像头不可用时：展示遮罩与重试按钮
- 生成失败时：进入失败状态并允许重新生成
- 保存页无操作 60 秒：自动返回首页

## 状态传递

- `sessionStorage` 保存 `styleId`、`imageBase64`、`resultUrl`
- 同步 Provider 使用内存缓存为轮询提供结果
